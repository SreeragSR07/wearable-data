<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Wearable Device Dashboard</title>
    <style>
        /* Previous CSS remains the same */
        .emergency-box {
            animation: emergencyPulse 1s infinite;
            background-color: #ffebee;
            border: 2px solid #ff4b2b;
        }
        .emergency-text {
            color: #e74c3c;
            font-weight: bold;
        }
        .sos-button {
            background: linear-gradient(135deg, #ff4b2b, #ff416c);
            color: white;
            font-weight: bold;
        }
        /* ... (rest of your existing CSS) ... */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Live Sensor Data Dashboard</h1>
        <p class="timestamp">Last Updated: <span id="timestamp">Loading...</span></p>
        <div id="errorDisplay" class="error-message"></div>
        
        <div class="data-grid">
            <!-- Existing data boxes... -->
            
            <!-- Manual SOS Box -->
            <div class="data-box" id="sosBox">
                <i class="fas fa-bell"></i>
                <p>Emergency Button</p>
                <button class="location-btn sos-button" id="sosButton">PRESS FOR SOS</button>
                <span id="sosStatus">Ready</span>
            </div>
            
            <!-- Automatic Alerts Box -->
            <div class="data-box" id="alertBox">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Automatic Alerts</p>
                <span id="autoAlertStatus">All systems normal</span>
            </div>
        </div>
    </div>

    <script>
        // Updated emergency detection logic
        function checkEmergencies(data, accelX, accelY, accelZ, lat, lon) {
            // Reset automatic alerts
            const autoAlerts = [];
            
            // Check each condition
            if (data.field8 === "1") autoAlerts.push("LOW BATTERY");
            if (data.field1 && (data.field1 < 50 || data.field1 > 150)) autoAlerts.push("HEART RATE");
            if (Math.abs(accelX) > 20 || Math.abs(accelY) > 20 || Math.abs(accelZ) > 20) autoAlerts.push("HIGH IMPACT");
            
            // Update display
            const alertBox = document.getElementById("alertBox");
            const alertStatus = document.getElementById("autoAlertStatus");
            
            if (autoAlerts.length > 0) {
                alertBox.classList.add("emergency-box");
                alertStatus.textContent = `${autoAlerts.join(", ")} ALERT!`;
                triggerAlarm();
            } else {
                alertBox.classList.remove("emergency-box");
                alertStatus.textContent = "All systems normal";
            }
            
            // Handle SOS button separately
            const sosBox = document.getElementById("sosBox");
            const sosStatus = document.getElementById("sosStatus");
            
            if (data.field5 === "1") {
                sosBox.classList.add("emergency-box");
                sosStatus.textContent = "SOS ACTIVATED!";
                triggerAlarm();
            } else {
                sosBox.classList.remove("emergency-box");
                sosStatus.textContent = "Ready";
            }
        }
        
        // Rest of your existing JavaScript...
    </script>
</body>
</html>
