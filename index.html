<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wearable Device Live Data</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        .data-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        .data-box {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .data-box i {
            font-size: 100px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #56CCF2, #2F80ED);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .data-box span {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        #emergencyBox.emergency-active {
            animation: pulse 1s infinite;
            background-color: #ffebee;
            border: 2px solid #ff4b2b;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,75,43,0.4); }
            70% { box-shadow: 0 0 0 15px rgba(255,75,43,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,75,43,0); }
        }
        #errorDisplay {
            color: red;
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Live Sensor Data Dashboard</h1>
        <p>Last Updated: <span id="timestamp">Loading...</span></p>
        <div id="errorDisplay"></div>
        
        <div class="data-grid">
            <div class="data-box">
                <i class="fas fa-heartbeat"></i>
                <p>Heart Rate</p>
                <span id="heartRate">--</span> BPM
            </div>
            <div class="data-box">
                <i class="fas fa-map-marker-alt"></i>
                <p>GPS Location</p>
                <span id="gps">--</span>
                <button id="locationButton" style="margin-top:10px;padding:8px 16px;background:#56CCF2;color:white;border:none;border-radius:5px;">Show Map</button>
            </div>
            <div class="data-box" id="emergencyBox">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Emergency Status</p>
                <span id="emergencyStatus">Normal</span>
            </div>
            <div class="data-box">
                <i class="fas fa-arrows-alt-h"></i>
                <p>Acceleration X</p>
                <span id="accelX">--</span> m/s²
            </div>
            <div class="data-box">
                <i class="fas fa-arrows-alt-v"></i>
                <p>Acceleration Y</p>
                <span id="accelY">--</span> m/s²
            </div>
            <div class="data-box">
                <i class="fas fa-arrow-up"></i>
                <p>Acceleration Z</p>
                <span id="accelZ">--</span> m/s²
            </div>
        </div>
    </div>

    <audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

    <script>
    // Test Data - Will show immediately
    const testData = {
        field1: "72",   // Heart rate
        field2: "0.12", // Accel X
        field3: "0.98", // Accel Y
        field4: "9.81", // Accel Z
        field5: "0",    // Manual SOS
        field6: "10.178180", // Latitude
        field7: "76.431107", // Longitude
        field8: "0",    // Battery status
        created_at: new Date().toISOString()
    };

    function updateDashboard(data) {
        // Update all data fields
        document.getElementById("heartRate").textContent = data.field1 || "--";
        document.getElementById("accelX").textContent = data.field2 ? parseFloat(data.field2).toFixed(2) : "--";
        document.getElementById("accelY").textContent = data.field3 ? parseFloat(data.field3).toFixed(2) : "--";
        document.getElementById("accelZ").textContent = data.field4 ? parseFloat(data.field4).toFixed(2) : "--";
        
        // Update GPS
        if (data.field6 && data.field7) {
            const lat = parseFloat(data.field6).toFixed(6);
            const lon = parseFloat(data.field7).toFixed(6);
            document.getElementById("gps").textContent = `${lat}, ${lon}`;
            document.getElementById("locationButton").onclick = () => {
                window.open(`https://www.google.com/maps?q=${lat},${lon}`, "_blank");
            };
            document.getElementById("locationButton").disabled = false;
        } else {
            document.getElementById("gps").textContent = "No GPS signal";
            document.getElementById("locationButton").disabled = true;
        }
        
        // Update timestamp
        document.getElementById("timestamp").textContent = 
            data.created_at ? new Date(data.created_at).toLocaleString() : "Just now";
    }

    // Immediately display test data
    updateDashboard(testData);
    document.getElementById("errorDisplay").textContent = "Displaying test data - connecting to live feed...";

    // Then try to connect to real API
    async function connectToAPI() {
        try {
            const apiKey = "JB035BQVNPNCBMKN";
            const channelID = "2865083";
            const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds/last.json?api_key=${apiKey}`);
            
            if (!response.ok) throw new Error("API connection failed");
            
            const data = await response.json();
            if (!data || Object.keys(data).length === 0) throw new Error("No data received");
            
            updateDashboard(data);
            document.getElementById("errorDisplay").textContent = "Connected to live data";
            
        } catch (error) {
            document.getElementById("errorDisplay").textContent = 
                `Live data unavailable: ${error.message}. Using test data.`;
        }
    }

    // Try to connect every 5 seconds
    connectToAPI();
    setInterval(connectToAPI, 5000);
    </script>
</body>
</html>
