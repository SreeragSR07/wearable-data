<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wearable Device Live Data</title>
    <style>
        /* [All previous CSS styles remain exactly the same] */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Live Sensor Data Dashboard</h1>
        <p class="timestamp">Last Updated: <span id="timestamp">Loading...</span></p>
        <div id="errorDisplay" class="error-message"></div>
        
        <div class="data-grid">
            <!-- [All previous HTML structure remains the same] -->
        </div>
    </div>
    
    <audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiKey = "JB035BQVNPNCBMKN";
            const channelID = "2865083";
            const defaultLat = 10.178180;
            const defaultLon = 76.431107;
            let alertPlaying = false;
            
            // Initialize with default location
            document.getElementById("gps").textContent = `${defaultLat}, ${defaultLon}`;
            document.getElementById("locationButton").onclick = function() {
                window.open(`https://www.google.com/maps?q=${defaultLat},${defaultLon}`, "_blank");
            };

            async function fetchData() {
                try {
                    // Using test data for demonstration
                    const testData = {
                        field1: "72",  // Heart rate
                        field2: "0.12", // Accel X
                        field3: "0.98", // Accel Y
                        field4: "9.81", // Accel Z
                        field5: "0",    // Manual SOS
                        field6: "10.178280", // Latitude (slightly different from default)
                        field7: "76.431207", // Longitude
                        field8: "0",     // Battery status
                        created_at: new Date().toISOString()
                    };
                    
                    // In production, replace with:
                    // const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds/last.json?api_key=${apiKey}`);
                    // const data = await response.json();
                    const data = testData; // Remove this line in production
                    
                    // Update data fields
                    document.getElementById("heartRate").textContent = data.field1 || "--";
                    document.getElementById("accelX").textContent = data.field2 ? parseFloat(data.field2).toFixed(2) : "--";
                    document.getElementById("accelY").textContent = data.field3 ? parseFloat(data.field3).toFixed(2) : "--";
                    document.getElementById("accelZ").textContent = data.field4 ? parseFloat(data.field4).toFixed(2) : "--";
                    
                    // Update GPS - use actual data if available, otherwise keep default
                    if (data.field6 && data.field7) {
                        const lat = parseFloat(data.field6).toFixed(6);
                        const lon = parseFloat(data.field7).toFixed(6);
                        document.getElementById("gps").textContent = `${lat}, ${lon}`;
                        document.getElementById("locationButton").onclick = function() {
                            window.open(`https://www.google.com/maps?q=${lat},${lon}`, "_blank");
                        };
                    }
                    
                    // Check for emergencies
                    checkEmergencies(data);
                    
                    // Update timestamp
                    document.getElementById("timestamp").textContent = data.created_at ? 
                        new Date(data.created_at).toLocaleString() : "Not available";
                        
                } catch (error) {
                    console.error("Fetch error:", error);
                    document.getElementById("errorDisplay").textContent = 
                        "Connection error - retrying...";
                    // GPS will keep showing the default location without "Offline" label
                }
            }

            // [Rest of your JavaScript functions remain exactly the same]
            
            // Initial fetch and then every 5 seconds
            fetchData();
            setInterval(fetchData, 5000);
        });
    </script>
</body>
</html>
